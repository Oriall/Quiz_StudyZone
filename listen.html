<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IT Quiz - Listening</title>
    <link rel="shortcut icon" href="./img/Neko_Gojo_sensei-removebg-preview.png" type="image/x-icon">
    <link rel="stylesheet" href="./listen.css">

</head>

<body>
    <div class="container">
        <!-- Screen 1: Name Input -->
        <div id="nameScreen" class="screen active">
            <h1>üéß Japanese Listening Practice</h1>
            <p>Luy·ªán nghe ti·∫øng Nh·∫≠t</p>
            <div class="input-group">
                <label>Nh·∫≠p t√™n c·ªßa b·∫°n:</label>
                <input type="text" id="playerNameInput" placeholder="T√™n c·ªßa b·∫°n..." maxlength="20" />
            </div>
            <button class="btn" onclick="submitName()">B·∫Øt ƒë·∫ßu</button>
        </div>

        <!-- Screen 2: Type Selection -->
        <div id="typeScreen" class="screen">
            <h1>Ch·ªçn d·∫°ng b√†i luy·ªán nghe</h1>
            <div class="type-selection">
                <button class="type-card" onclick="selectType('conversation')">
                    <div class="icon">üí¨</div>
                    <h3>H·ªôi tho·∫°i</h3>
                    <p>Luy·ªán nghe ƒëo·∫°n h·ªôi tho·∫°i</p>
                </button>
                <button class="type-card" onclick="selectType('time')">
                    <div class="icon">üïê</div>
                    <h3>Gi·ªù</h3>
                    <p>Luy·ªán nghe th·ªùi gian</p>
                </button>
                <button class="type-card" onclick="selectType('price')">
                    <div class="icon">üí∞</div>
                    <h3>Gi√° ti·ªÅn</h3>
                    <p>Luy·ªán nghe gi√° c·∫£</p>
                </button>
            </div>
        </div>

        <!-- Screen 3: Quiz -->
        <div id="quizScreen" class="screen">
            <div class="header">
                <div class="player-info">üë§ <span id="playerName">Guest</span></div>
                <div class="stats">
                    <div class="stat-item">
                        <div class="stat-label">ƒêi·ªÉm</div>
                        <div class="stat-value" id="scoreDisplay">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Streak</div>
                        <div class="stat-value">üî• <span id="streakDisplay">0</span></div>
                    </div>
                </div>
                <div class="action-buttons">
                    <button class="icon-btn" onclick="showLeaderboard()" title="B·∫£ng x·∫øp h·∫°ng">üèÜ</button>
                    <button class="icon-btn" onclick="saveToLeaderboard()" title="L∆∞u k·∫øt qu·∫£">üíæ</button>
                </div>
            </div>

            <div id="loadingBox" class="loading" style="display: none;">
                <div class="spinner"></div>
                <p>ƒêang t·∫°o c√¢u h·ªèi...</p>
            </div>

            <div id="questionContent" style="display: none;">
                <div class="audio-player">
                    <button class="play-btn" id="playBtn" onclick="playAudio()">
                        <span id="playIcon">üîä</span>
                        <span id="playText">Nghe l·∫°i</span>
                    </button>
                    <p>Nh·∫•n ƒë·ªÉ nghe ƒëo·∫°n h·ªôi tho·∫°i</p>
                </div>

                <div class="question-box">
                    <h3 id="questionText">C√¢u h·ªèi...</h3>
                    <div class="input-group">
                        <label id="inputLabel">Nh·∫≠p c√¢u tr·∫£ l·ªùi c·ªßa b·∫°n:</label>
                        <input type="text" id="answerInput" class="answer-input" placeholder="Nh·∫≠p c√¢u tr·∫£ l·ªùi..." />
                        <p class="hint-text" id="hintText"></p>
                    </div>
                </div>

                <div id="feedbackBox" class="feedback" style="display: none;"></div>

                <div class="btn-group">
                    <button class="btn" id="submitBtn" onclick="submitAnswer()">Tr·∫£ l·ªùi</button>
                    <button class="btn" id="nextBtn" onclick="nextQuestion()" style="display: none;">C√¢u ti·∫øp theo
                        ‚û°Ô∏è</button>
                </div>

                <div class="back-link" onclick="backToTypeSelection()">‚Üê ƒê·ªïi d·∫°ng b√†i</div>
            </div>
        </div>
    </div>

    <!-- Leaderboard Modal -->
    <div id="leaderboardModal" class="modal">
        <div class="modal-content">
            <h2>üèÜ B·∫£ng X·∫øp H·∫°ng</h2>
            <div id="leaderboardList"></div>
            <button class="btn btn-secondary" onclick="closeLeaderboard()">ƒê√≥ng</button>
        </div>
    </div>

    <script>
        let playerName = '';
        let listeningType = '';
        let currentQuestion = null;
        let score = 0;
        let streak = 0;
        let isPlaying = false;
        let questionHistory = [];

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
        }

        function submitName() {
            const input = document.getElementById('playerNameInput');
            if (input.value.trim()) {
                playerName = input.value.trim();
                document.getElementById('playerName').textContent = playerName;
                showScreen('typeScreen');
            }
        }

        document.getElementById('playerNameInput')?.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') submitName();
        });

        function selectType(type) {
            listeningType = type;
            questionHistory = [];
            showScreen('quizScreen');
            generateQuestion();
        }

        async function generateQuestion() {
            document.getElementById('loadingBox').style.display = 'block';
            document.getElementById('questionContent').style.display = 'none';
            document.getElementById('feedbackBox').style.display = 'none';
            document.getElementById('submitBtn').style.display = 'block';
            document.getElementById('nextBtn').style.display = 'none';

            const avoidList = questionHistory.length > 0
                ? `\n\nTR√ÅNH L·∫∂P L·∫†I c√°c c√¢u h·ªèi sau:\n${questionHistory.map((q, i) => `${i + 1}. ${q}`).join('\n')}\n\nH√£y t·∫°o c√¢u h·ªèi KH√ÅC HO√ÄN TO√ÄN v·ªõi c√°c c√¢u tr√™n.`
                : '';

            let prompt = '';
            if (listeningType === 'conversation') {
                prompt = `T·∫°o m·ªôt b√†i luy·ªán nghe ti·∫øng Nh·∫≠t c·∫•p ƒë·ªô N5-N4. Y√™u c·∫ßu:
1. T·∫°o m·ªôt ƒëo·∫°n h·ªôi tho·∫°i ng·∫Øn 2-3 c√¢u gi·ªØa 2 ng∆∞·ªùi b·∫±ng ti·∫øng Nh·∫≠t (ch·ªâ d√πng Hiragana v√† Katakana, KH√îNG d√πng Kanji)
2. ƒê·∫∑t 1 c√¢u h·ªèi v·ªÅ n·ªôi dung h·ªôi tho·∫°i b·∫±ng ti·∫øng Vi·ªát
3. Cung c·∫•p ƒë√°p √°n ƒë√∫ng b·∫±ng ti·∫øng Vi·ªát (c√¢u tr·∫£ l·ªùi ng·∫Øn g·ªçn)
4. Cung c·∫•p c√°c t·ª´ kh√≥a ch·∫•p nh·∫≠n (variations) - nh·ªØng c√°ch tr·∫£ l·ªùi t∆∞∆°ng t·ª± ƒë∆∞·ª£c xem l√† ƒë√∫ng

V√≠ d·ª• h·ªôi tho·∫°i: "„ÅÇÔºö„Åä„ÅØ„Çà„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åô„ÄÇBÔºö„Åä„ÅØ„Çà„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åô„ÄÇ„Åç„Çá„ÅÜ„ÅØ„ÅÑ„ÅÑ„Å¶„Çì„Åç„Åß„Åô„Å≠„ÄÇ"
${avoidList}

CH·ªà tr·∫£ v·ªÅ JSON format (KH√îNG c√≥ markdown, KH√îNG c√≥ gi·∫£i th√≠ch th√™m):
{
  "japanese_text": "ƒëo·∫°n h·ªôi tho·∫°i ti·∫øng Nh·∫≠t (ch·ªâ Hiragana/Katakana)",
  "question": "c√¢u h·ªèi ti·∫øng Vi·ªát",
  "correct_answer": "ƒë√°p √°n ch√≠nh x√°c ng·∫Øn g·ªçn",
  "accepted_variations": ["ƒë√°p √°n 1", "ƒë√°p √°n 2", "ƒë√°p √°n 3"],
  "explanation": "gi·∫£i th√≠ch ng·∫Øn b·∫±ng ti·∫øng Vi·ªát"
}`;
            } else if (listeningType === 'time') {
                prompt = `T·∫°o m·ªôt b√†i luy·ªán nghe th·ªùi gian ti·∫øng Nh·∫≠t c·∫•p ƒë·ªô N5. Y√™u c·∫ßu:
1. T·∫°o M·ªòT c√¢u n√≥i v·ªÅ th·ªùi gian b·∫±ng ti·∫øng Nh·∫≠t (CH·ªà d√πng Hiragana, KH√îNG d√πng Kanji)
2. Th·ªùi gian ph·∫£i r√µ r√†ng v√† ƒë√∫ng ng·ªØ ph√°p ti·∫øng Nh·∫≠t
3. H·ªèi ng∆∞·ªùi h·ªçc ƒë√¢y l√† m·∫•y gi·ªù
4. ƒê√°p √°n ƒë√∫ng theo format r√µ r√†ng (v√≠ d·ª•: "9:30", "9 gi·ªù 30", "9h30")
5. Cung c·∫•p c√°c c√°ch vi·∫øt ch·∫•p nh·∫≠n ƒë∆∞·ª£c (v·ªõi/kh√¥ng d·∫•u c√°ch, c√≥/kh√¥ng c√≥ "gi·ªù", v.v.)

V√≠ d·ª•: "„ÅÑ„Åæ„Åî„Åú„Çì„Åè„Åò„ÅØ„Çì„Åß„Åô„ÄÇ" (B√¢y gi·ªù l√† 9:30 s√°ng)
C√°c t·ª´ v·ªÅ gi·ªù: „ÅÑ„Å°„Åò(1h), „Å´„Åò(2h), „Åï„Çì„Åò(3h), „Çà„Åò(4h), „Åî„Åò(5h), „Çç„Åè„Åò(6h), „Åó„Å°„Åò(7h), „ÅØ„Å°„Åò(8h), „Åè„Åò(9h), „Åò„ÇÖ„ÅÜ„Åò(10h), „Åò„ÇÖ„ÅÜ„ÅÑ„Å°„Åò(11h), „Åò„ÇÖ„ÅÜ„Å´„Åò(12h)
„ÅØ„Çì = 30 ph√∫t, „Åî„Åú„Çì = s√°ng (AM), „Åî„Åî = chi·ªÅu (PM)
${avoidList}

CH·ªà tr·∫£ v·ªÅ JSON format (KH√îNG c√≥ markdown):
{
  "japanese_text": "c√¢u ti·∫øng Nh·∫≠t v·ªÅ gi·ªù (ch·ªâ Hiragana)",
  "question": "ƒê√¢y l√† m·∫•y gi·ªù?",
  "correct_answer": "9:30",
  "accepted_variations": ["9:30", "9h30", "9 gi·ªù 30", "930"],
  "explanation": "ƒê√°p √°n l√† 9:30 s√°ng („Åî„Åú„Çì„Åè„Åò„ÅØ„Çì)"
}`;
            } else if (listeningType === 'price') {
                prompt = `T·∫°o m·ªôt b√†i luy·ªán nghe gi√° ti·ªÅn ti·∫øng Nh·∫≠t c·∫•p ƒë·ªô N5. Y√™u c·∫ßu:
1. T·∫°o M·ªòT c√¢u n√≥i v·ªÅ gi√° m·ªôt m√≥n ƒë·ªì b·∫±ng ti·∫øng Nh·∫≠t (CH·ªà d√πng Hiragana v√† Katakana, KH√îNG d√πng Kanji)
2. Gi√° ti·ªÅn ph·∫£i r√µ r√†ng v√† ƒë√∫ng c√°ch ƒë·ªçc s·ªë ti·ªÅn trong ti·∫øng Nh·∫≠t
3. H·ªèi ng∆∞·ªùi h·ªçc gi√° bao nhi√™u
4. ƒê√°p √°n ƒë√∫ng theo format s·ªë (v√≠ d·ª•: "1000", "1000 y√™n", "1000ÂÜÜ")
5. Cung c·∫•p c√°c c√°ch vi·∫øt ch·∫•p nh·∫≠n ƒë∆∞·ª£c

V√≠ d·ª•: "„Åì„ÅÆ„Åª„Çì„ÅØ„Åõ„Çì„Åà„Çì„Åß„Åô„ÄÇ" (Quy·ªÉn s√°ch n√†y gi√° 1000 y√™n)
C√°c s·ªë ti·ªÅn: „Å≤„ÇÉ„Åè„Åà„Çì(100ÂÜÜ), „Å´„Å≤„ÇÉ„Åè„Åà„Çì(200ÂÜÜ), „Åï„Çì„Å≥„ÇÉ„Åè„Åà„Çì(300ÂÜÜ), „Çà„Çì„Å≤„ÇÉ„Åè„Åà„Çì(400ÂÜÜ), „Åî„Å≤„ÇÉ„Åè„Åà„Çì(500ÂÜÜ), „Çç„Å£„Å¥„ÇÉ„Åè„Åà„Çì(600ÂÜÜ), „Å™„Å™„Å≤„ÇÉ„Åè„Åà„Çì(700ÂÜÜ), „ÅØ„Å£„Å¥„ÇÉ„Åè„Åà„Çì(800ÂÜÜ), „Åç„ÇÖ„ÅÜ„Å≤„ÇÉ„Åè„Åà„Çì(900ÂÜÜ), „Åõ„Çì„Åà„Çì(1000ÂÜÜ), „Å´„Åõ„Çì„Åà„Çì(2000ÂÜÜ), „Åï„Çì„Åú„Çì„Åà„Çì(3000ÂÜÜ)
${avoidList}

CH·ªà tr·∫£ v·ªÅ JSON format (KH√îNG c√≥ markdown):
{
  "japanese_text": "c√¢u ti·∫øng Nh·∫≠t v·ªÅ gi√° ti·ªÅn (ch·ªâ Hiragana/Katakana)",
  "question": "M√≥n ƒë·ªì n√†y gi√° bao nhi√™u?",
  "correct_answer": "1000",
  "accepted_variations": ["1000", "1000 y√™n", "1000ÂÜÜ", "1000 yen"],
  "explanation": "ƒê√°p √°n l√† 1000 y√™n („Åõ„Çì„Åà„Çì)"
}`;
            }

            try {
                const response = await fetch("https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=AIzaSyCbWfOla29VASM0_jlfPIhUCqeCyaZA5jU", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }]
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                let textResponse = data.candidates?.[0]?.content?.parts?.[0]?.text || "";

                if (!textResponse) {
                    throw new Error('No response from API');
                }

                textResponse = textResponse.replace(/```json\n?|```\n?/g, "").trim();

                try {
                    currentQuestion = JSON.parse(textResponse);
                } catch (parseError) {
                    const jsonMatch = textResponse.match(/\{[\s\S]*\}/);
                    if (jsonMatch) {
                        currentQuestion = JSON.parse(jsonMatch[0]);
                    } else {
                        throw new Error('Cannot parse JSON response');
                    }
                }

                if (!currentQuestion.japanese_text || !currentQuestion.question || !currentQuestion.correct_answer) {
                    throw new Error('Invalid question structure');
                }

                questionHistory.push(currentQuestion.japanese_text);
                if (questionHistory.length > 20) {
                    questionHistory.shift();
                }

                displayQuestion();
            } catch (error) {
                console.error('Error:', error);
                alert('‚ùå Kh√¥ng th·ªÉ t·∫°o c√¢u h·ªèi. Vui l√≤ng th·ª≠ l·∫°i!');
                document.getElementById('loadingBox').style.display = 'none';
                backToTypeSelection();
            }
        }

        function displayQuestion() {
            document.getElementById('loadingBox').style.display = 'none';
            document.getElementById('questionContent').style.display = 'block';

            if (!currentQuestion || !currentQuestion.question) {
                alert('‚ùå Kh√¥ng th·ªÉ t·∫£i c√¢u h·ªèi. Vui l√≤ng th·ª≠ l·∫°i!');
                return;
            }

            document.getElementById('questionText').textContent = currentQuestion.question;

            const answerInput = document.getElementById('answerInput');
            answerInput.value = '';
            answerInput.disabled = false;

            if (listeningType === 'time') {
                answerInput.placeholder = 'V√≠ d·ª•: 9:30 ho·∫∑c 9 gi·ªù 30';
                document.getElementById('inputLabel').textContent = 'Nh·∫≠p th·ªùi gian:';
                document.getElementById('hintText').textContent = 'G·ª£i √Ω: B·∫°n c√≥ th·ªÉ nh·∫≠p theo nhi·ªÅu c√°ch nh∆∞ "9:30", "9h30", "9 gi·ªù 30"';
            } else if (listeningType === 'price') {
                answerInput.placeholder = 'V√≠ d·ª•: 1000 ho·∫∑c 1000 y√™n';
                document.getElementById('inputLabel').textContent = 'Nh·∫≠p gi√° ti·ªÅn:';
                document.getElementById('hintText').textContent = 'G·ª£i √Ω: Ch·ªâ c·∫ßn nh·∫≠p s·ªë, c√≥ th·ªÉ th√™m "y√™n" ho·∫∑c "ÂÜÜ"';
            } else {
                answerInput.placeholder = 'Nh·∫≠p c√¢u tr·∫£ l·ªùi...';
                document.getElementById('inputLabel').textContent = 'Nh·∫≠p c√¢u tr·∫£ l·ªùi c·ªßa b·∫°n:';
                document.getElementById('hintText').textContent = 'G·ª£i √Ω: Nghe k·ªπ v√† tr·∫£ l·ªùi ng·∫Øn g·ªçn';
            }

            setTimeout(() => {
                playAudio();
                setTimeout(() => answerInput.focus(), 1000);
            }, 500);
        }

        function normalizeAnswer(answer) {
            return answer.toLowerCase()
                .trim()
                .replace(/\s+/g, '')
                .replace(/[.,!?;:]/g, '')
                .replace(/ÂÜÜ/g, '')
                .replace(/yen/g, '')
                .replace(/y√™n/g, '')
                .replace(/gi·ªù/g, '')
                .replace(/ph√∫t/g, '')
                .replace(/h/g, '')
                .replace(/:/g, '');
        }

        function checkAnswer(userAnswer) {
            const normalizedUser = normalizeAnswer(userAnswer);
            const normalizedCorrect = normalizeAnswer(currentQuestion.correct_answer);

            if (normalizedUser === normalizedCorrect) {
                return true;
            }

            if (currentQuestion.accepted_variations && Array.isArray(currentQuestion.accepted_variations)) {
                for (let variation of currentQuestion.accepted_variations) {
                    if (normalizeAnswer(variation) === normalizedUser) {
                        return true;
                    }
                }
            }

            return false;
        }

        function submitAnswer() {
            const answerInput = document.getElementById('answerInput');
            const userAnswer = answerInput.value.trim();

            if (!userAnswer) {
                alert('Vui l√≤ng nh·∫≠p c√¢u tr·∫£ l·ªùi!');
                return;
            }

            const feedbackBox = document.getElementById('feedbackBox');
            const isCorrect = checkAnswer(userAnswer);

            if (isCorrect) {
                score += 10;
                streak++;
                feedbackBox.className = 'feedback correct';
                feedbackBox.innerHTML = `‚úÖ Ch√≠nh x√°c!<br><strong>ƒê√°p √°n:</strong> ${currentQuestion.correct_answer}<br>${currentQuestion.explanation || ''}`;
            } else {
                streak = 0;
                feedbackBox.className = 'feedback incorrect';
                feedbackBox.innerHTML = `‚ùå Sai r·ªìi!<br><strong>B·∫°n tr·∫£ l·ªùi:</strong> ${userAnswer}<br><strong>ƒê√°p √°n ƒë√∫ng:</strong> ${currentQuestion.correct_answer}<br>${currentQuestion.explanation || ''}`;
            }

            feedbackBox.style.display = 'block';
            document.getElementById('submitBtn').style.display = 'none';
            document.getElementById('nextBtn').style.display = 'block';
            document.getElementById('scoreDisplay').textContent = score;
            document.getElementById('streakDisplay').textContent = streak;

            answerInput.disabled = true;
        }

        function nextQuestion() {
            generateQuestion();
        }

        function playAudio() {
            if (!currentQuestion || isPlaying) return;

            isPlaying = true;
            const playBtn = document.getElementById('playBtn');
            playBtn.disabled = true;
            playBtn.classList.add('playing');
            document.getElementById('playText').textContent = 'ƒêang ph√°t...';

            const utterance = new SpeechSynthesisUtterance(currentQuestion.japanese_text);
            utterance.lang = 'ja-JP';
            utterance.rate = 0.8;
            utterance.pitch = 1;

            utterance.onend = () => {
                isPlaying = false;
                playBtn.disabled = false;
                playBtn.classList.remove('playing');
                document.getElementById('playText').textContent = 'Nghe l·∫°i';
            };

            utterance.onerror = () => {
                isPlaying = false;
                playBtn.disabled = false;
                playBtn.classList.remove('playing');
                document.getElementById('playText').textContent = 'Nghe l·∫°i';
                alert('‚ö†Ô∏è Kh√¥ng th·ªÉ ph√°t √¢m thanh. Tr√¨nh duy·ªát c·ªßa b·∫°n c√≥ th·ªÉ kh√¥ng h·ªó tr·ª£ gi·ªçng n√≥i ti·∫øng Nh·∫≠t.');
            };

            window.speechSynthesis.cancel();
            window.speechSynthesis.speak(utterance);
        }

        function backToTypeSelection() {
            showScreen('typeScreen');
        }

        async function loadLeaderboard() {
            try {
                const result = await window.storage.get('japanese-listening-leaderboard', true);
                return result && result.value ? JSON.parse(result.value) : [];
            } catch (error) {
                return [];
            }
        }

        async function saveToLeaderboard() {
            if (!playerName || score === 0) {
                alert('‚ö†Ô∏è B·∫°n c·∫ßn c√≥ ƒëi·ªÉm tr∆∞·ªõc khi l∆∞u!');
                return;
            }

            const newEntry = {
                name: playerName,
                score: score,
                streak: streak,
                timestamp: Date.now()
            };

            let leaderboard = await loadLeaderboard();
            leaderboard.push(newEntry);
            leaderboard.sort((a, b) => b.score - a.score);
            leaderboard = leaderboard.slice(0, 10);

            try {
                await window.storage.set('japanese-listening-leaderboard', JSON.stringify(leaderboard), true);
                alert('‚úÖ ƒê√£ l∆∞u k·∫øt qu·∫£ v√†o b·∫£ng x·∫øp h·∫°ng!');
            } catch (error) {
                alert('‚ùå Kh√¥ng th·ªÉ l∆∞u k·∫øt qu·∫£');
            }
        }

        async function showLeaderboard() {
            const leaderboard = await loadLeaderboard();
            const list = document.getElementById('leaderboardList');

            if (leaderboard.length === 0) {
                list.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">Ch∆∞a c√≥ d·ªØ li·ªáu</p>';
            } else {
                list.innerHTML = leaderboard.map((entry, index) => `
          <div class="leaderboard-item">
            <div class="leaderboard-rank">#${index + 1}</div>
            <div class="leaderboard-info">
              <div class="leaderboard-name">${entry.name}</div>
              <div class="leaderboard-streak">Streak: üî• ${entry.streak}</div>
            </div>
            <div class="leaderboard-score">${entry.score}</div>
          </div>
        `).join('');
            }

            document.getElementById('leaderboardModal').classList.add('active');
        }

        function closeLeaderboard() {
            document.getElementById('leaderboardModal').classList.remove('active');
        }

        document.addEventListener('DOMContentLoaded', () => {
            const answerInput = document.getElementById('answerInput');
            if (answerInput) {
                answerInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' && !answerInput.disabled) {
                        submitAnswer();
                    }
                });
            }
        });
    </script>
</body>