<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IT Quiz - Listening</title>
    <link rel="shortcut icon" href="./img/Neko_Gojo_sensei-removebg-preview.png" type="image/x-icon">
    <link rel="stylesheet" href="./listen.css">

</head>

<body>
    <div class="container">
        <!-- Screen 1: Name Input -->
        <div id="nameScreen" class="screen active">
            <h1>ğŸ§ Japanese Listening Practice</h1>
            <p>Luyá»‡n nghe tiáº¿ng Nháº­t</p>
            <div class="input-group">
                <label>Nháº­p tÃªn cá»§a báº¡n:</label>
                <input type="text" id="playerNameInput" placeholder="TÃªn cá»§a báº¡n..." maxlength="20" />
            </div>
            <button class="btn" onclick="submitName()">Báº¯t Ä‘áº§u</button>
        </div>

        <!-- Screen 2: Type Selection -->
        <div id="typeScreen" class="screen">
            <h1>Chá»n dáº¡ng bÃ i luyá»‡n nghe</h1>
            <div class="type-selection">
                <button class="type-card" onclick="selectType('conversation')">
                    <div class="icon">ğŸ’¬</div>
                    <h3>Há»™i thoáº¡i</h3>
                    <p>Luyá»‡n nghe Ä‘oáº¡n há»™i thoáº¡i</p>
                </button>
                <button class="type-card" onclick="selectType('time')">
                    <div class="icon">ğŸ•</div>
                    <h3>Giá»</h3>
                    <p>Luyá»‡n nghe thá»i gian</p>
                </button>
                <button class="type-card" onclick="selectType('price')">
                    <div class="icon">ğŸ’°</div>
                    <h3>GiÃ¡ tiá»n</h3>
                    <p>Luyá»‡n nghe giÃ¡ cáº£</p>
                </button>
            </div>
        </div>

        <!-- Screen 3: Quiz -->
        <div id="quizScreen" class="screen">
            <div class="header">
                <div class="player-info">ğŸ‘¤ <span id="playerName">Guest</span></div>
                <div class="stats">
                    <div class="stat-item">
                        <div class="stat-label">Äiá»ƒm</div>
                        <div class="stat-value" id="scoreDisplay">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Streak</div>
                        <div class="stat-value">ğŸ”¥ <span id="streakDisplay">0</span></div>
                    </div>
                </div>
                <div class="action-buttons">
                    <button class="icon-btn" onclick="showLeaderboard()" title="Báº£ng xáº¿p háº¡ng">ğŸ†</button>
                    <button class="icon-btn" onclick="saveToLeaderboard()" title="LÆ°u káº¿t quáº£">ğŸ’¾</button>
                </div>
            </div>

            <div id="loadingBox" class="loading" style="display: none;">
                <div class="spinner"></div>
                <p>Äang táº¡o cÃ¢u há»i...</p>
            </div>

            <div id="questionContent" style="display: none;">
                <div class="audio-player">
                    <button class="play-btn" id="playBtn" onclick="playAudio()">
                        <span id="playIcon">ğŸ”Š</span>
                        <span id="playText">Nghe láº¡i</span>
                    </button>
                    <p>Nháº¥n Ä‘á»ƒ nghe Ä‘oáº¡n há»™i thoáº¡i</p>
                </div>

                <div class="question-box">
                    <h3 id="questionText">CÃ¢u há»i...</h3>
                    <div class="input-group">
                        <label id="inputLabel">Nháº­p cÃ¢u tráº£ lá»i cá»§a báº¡n:</label>
                        <input type="text" id="answerInput" class="answer-input" placeholder="Nháº­p cÃ¢u tráº£ lá»i..." />
                        <p class="hint-text" id="hintText"></p>
                    </div>
                </div>

                <div id="feedbackBox" class="feedback" style="display: none;"></div>

                <div class="btn-group">
                    <button class="btn" id="submitBtn" onclick="submitAnswer()">Tráº£ lá»i</button>
                    <button class="btn" id="nextBtn" onclick="nextQuestion()" style="display: none;">CÃ¢u tiáº¿p theo
                        â¡ï¸</button>
                </div>

                <div class="back-link" onclick="backToTypeSelection()">â† Äá»•i dáº¡ng bÃ i</div>
            </div>
        </div>
    </div>

    <!-- Leaderboard Modal -->
    <div id="leaderboardModal" class="modal">
        <div class="modal-content">
            <h2>ğŸ† Báº£ng Xáº¿p Háº¡ng</h2>
            <div id="leaderboardList"></div>
            <button class="btn btn-secondary" onclick="closeLeaderboard()">ÄÃ³ng</button>
        </div>
    </div>

    <script>
        let playerName = '';
        let listeningType = '';
        let currentQuestion = null;
        let score = 0;
        let streak = 0;
        let isPlaying = false;
        let questionHistory = [];

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
        }

        function submitName() {
            const input = document.getElementById('playerNameInput');
            if (input.value.trim()) {
                playerName = input.value.trim();
                document.getElementById('playerName').textContent = playerName;
                showScreen('typeScreen');
            }
        }

        document.getElementById('playerNameInput')?.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') submitName();
        });

        function selectType(type) {
            listeningType = type;
            questionHistory = [];
            score = 0;
            streak = 0;
            document.getElementById('scoreDisplay').textContent = '0';
            document.getElementById('streakDisplay').textContent = '0';
            showScreen('quizScreen');
            generateQuestion();
        }

        function numberToJapanese(num) {
            const ones = ['', 'ã„ã¡', 'ã«', 'ã•ã‚“', 'ã‚ˆã‚“', 'ã”', 'ã‚ã', 'ãªãª', 'ã¯ã¡', 'ãã‚…ã†'];
            const tens = ['', 'ã˜ã‚…ã†', 'ã«ã˜ã‚…ã†', 'ã•ã‚“ã˜ã‚…ã†', 'ã‚ˆã‚“ã˜ã‚…ã†', 'ã”ã˜ã‚…ã†'];

            if (num === 0) return 'ãœã‚';
            if (num < 10) return ones[num];
            if (num < 60) {
                const t = Math.floor(num / 10);
                const o = num % 10;
                return tens[t] + (o > 0 ? ones[o] : '');
            }

            let result = '';
            if (num >= 10000) {
                const man = Math.floor(num / 10000);
                result += (man === 1 ? 'ã„ã¡' : numberToJapanese(man)) + 'ã¾ã‚“';
                num %= 10000;
            }
            if (num >= 1000) {
                const sen = Math.floor(num / 1000);
                if (sen === 1) result += 'ã›ã‚“';
                else if (sen === 3) result += 'ã•ã‚“ãœã‚“';
                else if (sen === 8) result += 'ã¯ã£ã›ã‚“';
                else result += ones[sen] + 'ã›ã‚“';
                num %= 1000;
            }
            if (num >= 100) {
                const hyaku = Math.floor(num / 100);
                if (hyaku === 1) result += 'ã²ã‚ƒã';
                else if (hyaku === 3) result += 'ã•ã‚“ã³ã‚ƒã';
                else if (hyaku === 6) result += 'ã‚ã£ã´ã‚ƒã';
                else if (hyaku === 8) result += 'ã¯ã£ã´ã‚ƒã';
                else result += ones[hyaku] + 'ã²ã‚ƒã';
                num %= 100;
            }
            if (num >= 10) {
                const t = Math.floor(num / 10);
                result += tens[t];
                num %= 10;
            }
            if (num > 0) result += ones[num];

            return result;
        }

        function generateTimeQuestion() {
            const hour = Math.floor(Math.random() * 12) + 1;
            const minute = Math.floor(Math.random() * 60);
            const isPM = Math.random() > 0.5;

            const hourWords = ['', 'ã„ã¡ã˜', 'ã«ã˜', 'ã•ã‚“ã˜', 'ã‚ˆã˜', 'ã”ã˜', 'ã‚ãã˜',
                'ã—ã¡ã˜', 'ã¯ã¡ã˜', 'ãã˜', 'ã˜ã‚…ã†ã˜', 'ã˜ã‚…ã†ã„ã¡ã˜', 'ã˜ã‚…ã†ã«ã˜'];

            let japanese = 'ã„ã¾ã¯' + (isPM ? 'ã”ã”' : 'ã”ãœã‚“') + hourWords[hour];

            let minuteText = '';
            if (minute === 0) {
                minuteText = '';
            } else if (minute === 30) {
                minuteText = 'ã¯ã‚“';
            } else {
                minuteText = numberToJapanese(minute) + 'ãµã‚“';
            }

            japanese += minuteText + 'ã§ã™';

            const hourStr = hour.toString();
            const minuteStr = minute.toString().padStart(2, '0');
            const period = isPM ? ' chiá»u' : ' sÃ¡ng';

            return {
                japanese_text: japanese,
                question: 'ÄÃ¢y lÃ  máº¥y giá»?',
                correct_answer: `${hourStr}:${minuteStr}`,
                hour: hour,
                minute: minute,
                period: isPM ? 'PM' : 'AM',
                accepted_variations: [
                    `${hourStr}:${minuteStr}`,
                    `${hourStr}h${minuteStr}`,
                    `${hourStr} giá» ${minute}`,
                    `${hourStr}:${minuteStr}${period}`,
                    `${hourStr}h${minuteStr}${period}`
                ],
                explanation: `ÄÃ¡p Ã¡n lÃ  ${hourStr}:${minuteStr}${period}`
            };
        }

        function generatePriceQuestion() {
            // Táº¡o sá»‘ ngáº«u nhiÃªn phá»©c táº¡p theo cÃ¡c má»©c giÃ¡ khÃ¡c nhau
            let price;
            const priceType = Math.random();

            if (priceType < 0.3) {
                // GiÃ¡ ráº»: 50-999 yÃªn
                price = Math.floor(Math.random() * 950) + 50;
            } else if (priceType < 0.6) {
                // GiÃ¡ trung bÃ¬nh: 1,000-9,999 yÃªn
                price = Math.floor(Math.random() * 9000) + 1000;
            } else if (priceType < 0.85) {
                // GiÃ¡ cao: 10,000-99,999 yÃªn
                price = Math.floor(Math.random() * 90000) + 10000;
            } else {
                // GiÃ¡ ráº¥t cao: 100,000-999,999 yÃªn
                price = Math.floor(Math.random() * 900000) + 100000;
            }

            const items = [
                'ã“ã®ã»ã‚“', 'ã“ã®ãƒšãƒ³', 'ã“ã®ãƒãƒ¼ãƒˆ', 'ã“ã®ã‹ã°ã‚“', 'ã“ã®ã¨ã‘ã„',
                'ã“ã®ãã¤', 'ã“ã®ã‚·ãƒ£ãƒ„', 'ã“ã®ã‹ã•', 'ã“ã®ã¼ã†ã—', 'ã“ã®ã‚«ãƒ¡ãƒ©'
            ];
            const item = items[Math.floor(Math.random() * items.length)];

            const japanese = item + 'ã¯' + numberToJapanese(price) + 'ãˆã‚“ã§ã™';

            return {
                japanese_text: japanese,
                question: 'MÃ³n Ä‘á»“ nÃ y giÃ¡ bao nhiÃªu?',
                correct_answer: price.toString(),
                accepted_variations: [
                    price.toString(),
                    `${price} yÃªn`,
                    `${price} yen`,
                    `${price}å††`,
                    `${price}yÃªn`,
                    price.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ","), // ThÃªm dáº¥u pháº©y: 1,234
                    price.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".") // ThÃªm dáº¥u cháº¥m: 1.234
                ],
                explanation: `ÄÃ¡p Ã¡n lÃ  ${price.toLocaleString('vi-VN')} yÃªn`
            };
        }

        async function generateQuestion() {
            document.getElementById('loadingBox').style.display = 'block';
            document.getElementById('questionContent').style.display = 'none';
            document.getElementById('feedbackBox').style.display = 'none';
            document.getElementById('submitBtn').style.display = 'block';
            document.getElementById('nextBtn').style.display = 'none';

            if (listeningType === 'time') {
                currentQuestion = generateTimeQuestion();
                displayQuestion();
            } else if (listeningType === 'price') {
                currentQuestion = generatePriceQuestion();
                displayQuestion();
            } else if (listeningType === 'conversation') {
                const avoidList = questionHistory.length > 0
                    ? `\n\nTRÃNH Láº¶P Láº I cÃ¡c cÃ¢u há»i sau:\n${questionHistory.map((q, i) => `${i + 1}. ${q}`).join('\n')}\n\nHÃ£y táº¡o cÃ¢u há»i KHÃC HOÃ€N TOÃ€N vá»›i cÃ¡c cÃ¢u trÃªn.`
                    : '';

                let prompt = `Táº¡o má»™t bÃ i luyá»‡n nghe tiáº¿ng Nháº­t cáº¥p Ä‘á»™ N5-N4. YÃªu cáº§u:
1. Táº¡o má»™t Ä‘oáº¡n há»™i thoáº¡i ngáº¯n 2-3 cÃ¢u giá»¯a 2 ngÆ°á»i báº±ng tiáº¿ng Nháº­t (chá»‰ dÃ¹ng Hiragana vÃ  Katakana, KHÃ”NG dÃ¹ng Kanji)
2. Äáº·t 1 cÃ¢u há»i vá» ná»™i dung há»™i thoáº¡i báº±ng tiáº¿ng Viá»‡t
3. Cung cáº¥p Ä‘Ã¡p Ã¡n Ä‘Ãºng báº±ng tiáº¿ng Viá»‡t (cÃ¢u tráº£ lá»i ngáº¯n gá»n)
4. Cung cáº¥p cÃ¡c tá»« khÃ³a cháº¥p nháº­n (variations) - nhá»¯ng cÃ¡ch tráº£ lá»i tÆ°Æ¡ng tá»± Ä‘Æ°á»£c xem lÃ  Ä‘Ãºng

VÃ­ dá»¥ há»™i thoáº¡i: "Aï¼šãŠã¯ã‚ˆã†ã”ã–ã„ã¾ã™ã€‚Bï¼šãŠã¯ã‚ˆã†ã”ã–ã„ã¾ã™ã€‚ãã‚‡ã†ã¯ã„ã„ã¦ã‚“ãã§ã™ã­ã€‚"
${avoidList}

CHá»ˆ tráº£ vá» JSON format (KHÃ”NG cÃ³ markdown, KHÃ”NG cÃ³ giáº£i thÃ­ch thÃªm):
{
  "japanese_text": "Ä‘oáº¡n há»™i thoáº¡i tiáº¿ng Nháº­t (chá»‰ Hiragana/Katakana)",
  "question": "cÃ¢u há»i tiáº¿ng Viá»‡t",
  "correct_answer": "Ä‘Ã¡p Ã¡n chÃ­nh xÃ¡c ngáº¯n gá»n",
  "accepted_variations": ["Ä‘Ã¡p Ã¡n 1", "Ä‘Ã¡p Ã¡n 2", "Ä‘Ã¡p Ã¡n 3"],
  "explanation": "giáº£i thÃ­ch ngáº¯n báº±ng tiáº¿ng Viá»‡t"
}`;

                try {
                    const response = await fetch("https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=AIzaSyCbWfOla29VASM0_jlfPIhUCqeCyaZA5jU", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: prompt }] }]
                        })
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const data = await response.json();
                    let textResponse = data.candidates?.[0]?.content?.parts?.[0]?.text || "";

                    if (!textResponse) {
                        throw new Error('No response from API');
                    }

                    textResponse = textResponse.replace(/```json\n?|```\n?/g, "").trim();

                    try {
                        currentQuestion = JSON.parse(textResponse);
                    } catch (parseError) {
                        const jsonMatch = textResponse.match(/\{[\s\S]*\}/);
                        if (jsonMatch) {
                            currentQuestion = JSON.parse(jsonMatch[0]);
                        } else {
                            throw new Error('Cannot parse JSON response');
                        }
                    }

                    if (!currentQuestion.japanese_text || !currentQuestion.question || !currentQuestion.correct_answer) {
                        throw new Error('Invalid question structure');
                    }

                    questionHistory.push(currentQuestion.japanese_text);
                    if (questionHistory.length > 20) {
                        questionHistory.shift();
                    }

                    displayQuestion();
                } catch (error) {
                    console.error('Error:', error);
                    alert('âŒ KhÃ´ng thá»ƒ táº¡o cÃ¢u há»i. Vui lÃ²ng thá»­ láº¡i!');
                    document.getElementById('loadingBox').style.display = 'none';
                    backToTypeSelection();
                }
            }
        }

        function displayQuestion() {
            document.getElementById('loadingBox').style.display = 'none';
            document.getElementById('questionContent').style.display = 'block';

            if (!currentQuestion || !currentQuestion.question) {
                alert('âŒ KhÃ´ng thá»ƒ táº£i cÃ¢u há»i. Vui lÃ²ng thá»­ láº¡i!');
                return;
            }

            document.getElementById('questionText').textContent = currentQuestion.question;

            const answerInput = document.getElementById('answerInput');
            answerInput.value = '';
            answerInput.disabled = false;

            if (listeningType === 'time') {
                answerInput.placeholder = 'VÃ­ dá»¥: 9:30 hoáº·c 9 giá» 30';
                document.getElementById('inputLabel').textContent = 'Nháº­p thá»i gian:';
                document.getElementById('hintText').textContent = 'Gá»£i Ã½: Báº¡n cÃ³ thá»ƒ nháº­p theo nhiá»u cÃ¡ch nhÆ° "9:30", "9h30", "9 giá» 30"';
            } else if (listeningType === 'price') {
                answerInput.placeholder = 'VÃ­ dá»¥: 1000 hoáº·c 1000 yÃªn';
                document.getElementById('inputLabel').textContent = 'Nháº­p giÃ¡ tiá»n:';
                document.getElementById('hintText').textContent = 'Gá»£i Ã½: Chá»‰ cáº§n nháº­p sá»‘, cÃ³ thá»ƒ thÃªm "yÃªn" hoáº·c "å††"';
            } else {
                answerInput.placeholder = 'Nháº­p cÃ¢u tráº£ lá»i...';
                document.getElementById('inputLabel').textContent = 'Nháº­p cÃ¢u tráº£ lá»i cá»§a báº¡n:';
                document.getElementById('hintText').textContent = 'Gá»£i Ã½: Nghe ká»¹ vÃ  tráº£ lá»i ngáº¯n gá»n';
            }

            setTimeout(() => {
                playAudio();
                setTimeout(() => answerInput.focus(), 1000);
            }, 500);
        }

        function normalizeAnswer(answer) {
            return answer.toLowerCase()
                .trim()
                .replace(/\s+/g, '')
                .replace(/[.,!?;:]/g, '')
                .replace(/å††/g, '')
                .replace(/yen/g, '')
                .replace(/yÃªn/g, '')
                .replace(/giá»/g, '')
                .replace(/phÃºt/g, '')
                .replace(/h/g, '')
                .replace(/:/g, '')
                .replace(/sÃ¡ng/g, '')
                .replace(/chiá»u/g, '')
                .replace(/am/g, '')
                .replace(/pm/g, '');
        }

        function checkAnswer(userAnswer) {
            const normalizedUser = normalizeAnswer(userAnswer);
            const normalizedCorrect = normalizeAnswer(currentQuestion.correct_answer);

            if (normalizedUser === normalizedCorrect) {
                return true;
            }

            if (currentQuestion.accepted_variations && Array.isArray(currentQuestion.accepted_variations)) {
                for (let variation of currentQuestion.accepted_variations) {
                    if (normalizeAnswer(variation) === normalizedUser) {
                        return true;
                    }
                }
            }

            return false;
        }

        function submitAnswer() {
            const answerInput = document.getElementById('answerInput');
            const userAnswer = answerInput.value.trim();

            if (!userAnswer) {
                alert('Vui lÃ²ng nháº­p cÃ¢u tráº£ lá»i!');
                return;
            }

            const feedbackBox = document.getElementById('feedbackBox');
            const isCorrect = checkAnswer(userAnswer);

            if (isCorrect) {
                score += 10;
                streak++;
                feedbackBox.className = 'feedback correct';
                feedbackBox.innerHTML = `âœ… ChÃ­nh xÃ¡c!<br><strong>ÄÃ¡p Ã¡n:</strong> ${currentQuestion.correct_answer}<br>${currentQuestion.explanation || ''}`;
            } else {
                streak = 0;
                feedbackBox.className = 'feedback incorrect';
                feedbackBox.innerHTML = `âŒ Sai rá»“i!<br><strong>Báº¡n tráº£ lá»i:</strong> ${userAnswer}<br><strong>ÄÃ¡p Ã¡n Ä‘Ãºng:</strong> ${currentQuestion.correct_answer}<br>${currentQuestion.explanation || ''}`;
            }

            feedbackBox.style.display = 'block';
            document.getElementById('submitBtn').style.display = 'none';
            document.getElementById('nextBtn').style.display = 'block';
            document.getElementById('scoreDisplay').textContent = score;
            document.getElementById('streakDisplay').textContent = streak;

            answerInput.disabled = true;
        }

        function nextQuestion() {
            generateQuestion();
        }

        function playAudio() {
            if (!currentQuestion || isPlaying) return;

            isPlaying = true;
            const playBtn = document.getElementById('playBtn');
            playBtn.disabled = true;
            playBtn.classList.add('playing');
            document.getElementById('playText').textContent = 'Äang phÃ¡t...';

            const utterance = new SpeechSynthesisUtterance(currentQuestion.japanese_text);
            utterance.lang = 'ja-JP';
            utterance.rate = 0.8;
            utterance.pitch = 1;

            utterance.onend = () => {
                isPlaying = false;
                playBtn.disabled = false;
                playBtn.classList.remove('playing');
                document.getElementById('playText').textContent = 'Nghe láº¡i';
            };

            utterance.onerror = () => {
                isPlaying = false;
                playBtn.disabled = false;
                playBtn.classList.remove('playing');
                document.getElementById('playText').textContent = 'Nghe láº¡i';
                alert('âš ï¸ KhÃ´ng thá»ƒ phÃ¡t Ã¢m thanh. TrÃ¬nh duyá»‡t cá»§a báº¡n cÃ³ thá»ƒ khÃ´ng há»— trá»£ giá»ng nÃ³i tiáº¿ng Nháº­t.');
            };

            window.speechSynthesis.cancel();
            window.speechSynthesis.speak(utterance);
        }

        function backToTypeSelection() {
            showScreen('typeScreen');
        }

        async function loadLeaderboard() {
            try {
                const result = await window.storage.get('japanese-listening-leaderboard', true);
                return result && result.value ? JSON.parse(result.value) : [];
            } catch (error) {
                return [];
            }
        }

        async function saveToLeaderboard() {
            if (!playerName || score === 0) {
                alert('âš ï¸ Báº¡n cáº§n cÃ³ Ä‘iá»ƒm trÆ°á»›c khi lÆ°u!');
                return;
            }

            const newEntry = {
                name: playerName,
                score: score,
                streak: streak,
                timestamp: Date.now()
            };

            let leaderboard = await loadLeaderboard();
            leaderboard.push(newEntry);
            leaderboard.sort((a, b) => b.score - a.score);
            leaderboard = leaderboard.slice(0, 10);

            try {
                await window.storage.set('japanese-listening-leaderboard', JSON.stringify(leaderboard), true);
                alert('âœ… ÄÃ£ lÆ°u káº¿t quáº£ vÃ o báº£ng xáº¿p háº¡ng!');
            } catch (error) {
                alert('âŒ KhÃ´ng thá»ƒ lÆ°u káº¿t quáº£');
            }
        }

        async function showLeaderboard() {
            const leaderboard = await loadLeaderboard();
            const list = document.getElementById('leaderboardList');

            if (leaderboard.length === 0) {
                list.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">ChÆ°a cÃ³ dá»¯ liá»‡u</p>';
            } else {
                list.innerHTML = leaderboard.map((entry, index) => `
                    <div class="leaderboard-item">
                        <div class="leaderboard-rank">#${index + 1}</div>
                        <div class="leaderboard-info">
                            <div class="leaderboard-name">${entry.name}</div>
                            <div class="leaderboard-streak">Streak: ğŸ”¥ ${entry.streak}</div>
                        </div>
                        <div class="leaderboard-score">${entry.score}</div>
                    </div>
                `).join('');
            }

            document.getElementById('leaderboardModal').classList.add('active');
        }

        function closeLeaderboard() {
            document.getElementById('leaderboardModal').classList.remove('active');
        }

        document.addEventListener('DOMContentLoaded', () => {
            const answerInput = document.getElementById('answerInput');
            if (answerInput) {
                answerInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' && !answerInput.disabled) {
                        submitAnswer();
                    }
                });
            }
        });
    </script>
</body>